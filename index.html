<!DOCTYPE html>
<html>
  <head>
    <title>Artificial..? Life!</title>
  </head>
  <body>
    <h1>Artificial..? Life!</h1>
    <canvas id="life" width="800" height="600"></canvas>
    <script>
      const canvas = document.getElementById('life');
      limitx = canvas.width
      limity = canvas.height

      context = document.getElementById("life").getContext('2d')
      
      draw = (posx, posy, color, sizex, sizey) => {
        context.fillStyle = color
        context.fillRect(posx, posy, sizex, sizey)
      }
      
      particles = []
      
      particle = (posx, posy, color) => {
        return {"posx": posx, "posy": posy, "velx": 0, "vely": 0, "color": color}
      }
      
      randomx = () => {
        return (Math.random() * 0.9 + 0.1) * limitx
      }
      
      randomy = () => {
        return (Math.random() * 0.9 + 0.1) * limity
      }

      create = (number, color) => {
        group =  []
        for(let i = 0; i < number; i++){
          group.push(particle(randomx(), randomy(), color))
          particles.push(group[i])
        }
        return group
      }
      
      rule = (particles1, particles2, g) => {
        for(let i = 0; i < particles1.length; i++){
          forcex = 0
          forcey = 0
          for(let j = 0; j < particles2.length; j++){
            p1 = particles1[i]
            p2 = particles2[j]
            distancex = p1.posx - p2.posx
            distancey = p1.posy - p2.posy
            distance = Math.sqrt(distancex * distancex + distancey * distancey)
            //senA = distancex / distance
            //cosA = distancey / distance
            if(distance > 0 && distance < 80){
              force = g * 1 / distance
              forcex += (force * distancex)
              forcey += (force * distancey)
            }
          }
          p1.velx = (p1.velx + forcex) * 0.5
          p1.vely = (p1.vely + forcey) * 0.5
          p1.posx += p1.velx
          p1.posy += p1.vely
          if(p1.posx <= 0 || p1.posx >= limitx){p1.velx *= -1}
          if(p1.posy <= 0 || p1.posy >= limity){p1.vely *= -1} 
        }
      }
      
      yellow = create(3, "yellow")
      //magenta = create(200, "magenta")
      //cyan = create(200, "cyan")
      
      update = () => {
        rule(yellow, yellow, -1)
        context.clearRect(0, 0, limitx, limity)
        draw(0, 0, "black", limitx, limity)
        for(i = 0; i < particles.length; i++){
          draw(particles[i].posx, particles[i].posy, particles[i].color, 5, 5)
        }
        requestAnimationFrame(update)
      }
      
      update();
      
    </script>
  </body>
</html>
